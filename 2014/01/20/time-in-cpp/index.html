<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45596498-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>Time in C++ | Gianluca Ciccarelli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Using time: the chrono headerUntil before the introduction of the chrono library in the STL with the C++11 standard, we were forced to deal with time in a couple of ways, notably using Boost or using">
<meta property="og:type" content="article">
<meta property="og:title" content="Time in C++">
<meta property="og:url" content="https://www.gergel.im/2014/01/20/time-in-cpp/index.html">
<meta property="og:site_name" content="Gianluca Ciccarelli">
<meta property="og:description" content="Using time: the chrono headerUntil before the introduction of the chrono library in the STL with the C++11 standard, we were forced to deal with time in a couple of ways, notably using Boost or using">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2014-01-19T22:00:00.000Z">
<meta property="article:modified_time" content="2020-08-15T09:14:02.627Z">
<meta property="article:author" content="Gianluca Ciccarelli">
<meta property="article:tag" content="C++11">
<meta property="article:tag" content="chrono">
<meta property="article:tag" content="clock">
<meta property="article:tag" content="duration">
<meta property="article:tag" content="time_point">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@increatore">
  
    <link rel="alternate" href="/atom.xml" title="Gianluca Ciccarelli" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Gianluca Ciccarelli</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/index.html">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/now.html">Now</a>
        
          <a class="main-nav-link" href="/blog">Blog</a>
        
          <a class="main-nav-link" href="/fiction.html">Fiction</a>
        
          <a class="main-nav-link" href="/reads.html">Reads</a>
        
          <a class="main-nav-link" href="/software.html">Software</a>
        
          <a class="main-nav-link" href="/about-site.html">Website</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="//github.com/sturmer">GitHub</a>
        
          <a class="main-nav-link" href="/about-me.html">Me</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Ricerca"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://www.gergel.im"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-time-in-cpp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/01/20/time-in-cpp/" class="article-date">
  <!-- Use `hideDate: true` in a .md file to hide the date -->
  
  <time datetime="2014-01-19T22:00:00.000Z" itemprop="datePublished">2014-01-20</time>
  
</a>

    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Time in C++
    </h1>
  

        
          [662 words]
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Using-time-the-chrono-header"><a href="#Using-time-the-chrono-header" class="headerlink" title="Using time: the chrono header"></a>Using time: the chrono header</h3><p>Until before the introduction of the <code>chrono</code> library in the STL with the C++11 standard, we were forced to deal with time in a couple of ways, notably using Boost or using some wrapper around the <code>time.h</code> library header, from C.</p>
<a id="more"></a>

<p>With the latest standard (soon to be replaced by C++14!), most of the functionality of the Boost DateTime library has been ported to the STL, with some simplifications that are most welcome.</p>
<p>The <code>chrono</code> library header is based on a few concepts. The first is the concept of clock: the clock measures time. Three clocks are made available on the system, but for illustration purposes, their distinction is unimportant (we will see it later). The second concept is that of <em>duration</em>: it is intuitively an amount of time. The third is the concept of <code>time_point</code>: it is defined as a duration calculated with respect to an <em>epoch</em>, which in turn is the beginning of time.</p>
<h3 id="Duration"><a href="#Duration" class="headerlink" title="Duration"></a>Duration</h3><p>The simplest concept is the duration. In C++, it is defined as depending on two types, the numeric type we want to use to represent it, and the number of seconds per tick. The tick determines the resolution of the duration type: if we imagine a clock to tick once each tick seconds, then for example we can easily see that a duration in minutes can be expressed as:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">duration&lt;<span class="keyword">int</span>, <span class="built_in">std</span>::ratio&lt;<span class="number">60</span>&gt;&gt; mins;</span><br></pre></td></tr></table></figure>

<p>This simply means: my duration is represented as an <code>int</code>, and a duration of 3 would mean <em>three times 60 seconds</em>, or 3 minutes. <code>std::ratio</code> is a useful C++ type that expresses divisions. It is a compile-time constant, and when only one number is specified, then itâ€™s the numerator, and the denominator is 1. For example,</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::ratio&lt;<span class="number">1</span>, <span class="number">10</span>&gt;</span><br></pre></td></tr></table></figure>

<p>is a convenient way to write the fraction 1/10.</p>
<p>The STL predefines some convenient durations, like <code>minutes</code> (defined as above), <code>seconds</code>, and the likes. Durations can be easily converted between each other, so if we want to convert a duration in minutes into a duration in seconds, we would write:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> <span class="keyword">int</span> TICKS = <span class="number">20</span>;</span><br><span class="line">duration&lt;int, std::ratio&lt;60&gt;&gt; mins(TICKS);</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; mins.count() &lt;&lt; <span class="string">&quot; minutes = &quot;</span> &lt;&lt;</span><br><span class="line">    <span class="built_in">std</span>::chrono::seconds(mins).count() &lt;&lt; <span class="string">&quot; seconds\n&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>for which the output would be:</p>
<pre>
20 minutes = 1200 seconds
</pre>

<p>Notice the use of the method <code>count()</code>, that expresses the number of ticks in the duration.</p>
<p>Durations can easily be used with operators:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::chrono::minutes;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::chrono::hours;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::chrono::seconds;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">cout</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">hours <span class="title">d0</span><span class="params">(<span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">minutes <span class="title">d1</span><span class="params">(<span class="number">32</span>)</span></span>;</span><br><span class="line">    <span class="function">seconds <span class="title">d2</span><span class="params">(<span class="number">44</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> t = seconds(d0 + d1 + d2);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;2h32&#x27;44\&quot; = &quot;</span> &lt;&lt; t.count() &lt;&lt; <span class="string">&quot;\&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>would generate an output of:</p>
<pre>
2h32'44" = 9164"
</pre>

<h3 id="Time-points-and-clocks"><a href="#Time-points-and-clocks" class="headerlink" title="Time points and clocks"></a>Time points and clocks</h3><p>As said, time points are fundamentally a duration with respect to an epoch. A clock, on the other hand, is a structure containing (among the other things) a <code>time_point</code> and a <code>duration</code>. The following code would work on a system with an implementation of the I/O manipulator <code>put_time</code>:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::chrono::system_clock::time_point now =</span><br><span class="line">        <span class="built_in">std</span>::chrono::system_clock::now();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">time_t</span> as_tt = <span class="built_in">std</span>::chrono::system_clock::<span class="keyword">to_time_t</span>(now);</span><br><span class="line">    <span class="built_in">std</span>::tm* c_time = localtime(&amp;as_tt);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="built_in">std</span>::put_time(c_time, <span class="string">&quot;%H:%M:%S&quot;</span>) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Unfortunately, my system is not such system. This required me, in order to produce the same result, to hack with the C API provided by <code>chrono</code>:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::chrono::system_clock::time_point now = <span class="built_in">std</span>::chrono::system_clock::now();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">time_t</span> as_tt = <span class="built_in">std</span>::chrono::system_clock::<span class="keyword">to_time_t</span>(now);</span><br><span class="line">    <span class="built_in">std</span>::tm* c_time = localtime(&amp;as_tt);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">60</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    strftime(buf, <span class="keyword">sizeof</span>(buf), <span class="string">&quot;%Y/%m/%d@%H:%M:%S&quot;</span>, c_time);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; buf &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This generates the following output:</p>
<pre>
2014/01/20@19:35:13
</pre>

<p>Time points are easy to use together with clocks in order to compute some date in the future or in the past. For example, consider if we want to add one week to today, and know what day it is. We can easily do that with the following code:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">cout</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::chrono::system_clock::time_point;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    time_point now =</span><br><span class="line">        <span class="built_in">std</span>::chrono::system_clock::now();</span><br><span class="line"></span><br><span class="line">    time_point tp_later = now +</span><br><span class="line">        <span class="built_in">std</span>::chrono::hours(<span class="number">7</span>*<span class="number">24</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">time_t</span> later_as_tt = <span class="built_in">std</span>::chrono::system_clock::<span class="keyword">to_time_t</span>(tp_later);</span><br><span class="line">    <span class="built_in">std</span>::tm* c_time = localtime(&amp;later_as_tt);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">20</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    strftime(buf, <span class="keyword">sizeof</span>(buf), <span class="string">&quot;%Y/%m/%d&quot;</span>, c_time);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; buf &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pitfalls"><a href="#Pitfalls" class="headerlink" title="Pitfalls"></a>Pitfalls</h3><p>When dealing with durations and times, there are some pitfalls. The nice conversion operation we have seen with durations fails miserably at compile time, if the type used to represent the duration itself might lose precision when converted: for example, if you construct a duration in minutes represented with <code>int</code>, and use a duration in hours to initialize it, the compiler would bark because it would lose information during the construction process.</p>
<p>Other common issues come from the loss of precision in the clocks due to the machine not being able to have too precise time resolutions, or due to OSes that fail to update the clock faster than the resolution itself (example: resolution of 1 ms, and OS updating the clock every 10 ms).</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.gergel.im/2014/01/20/time-in-cpp/" data-id="ckj5urgmz003e5sptexf52k9a" class="article-share-link">Condividi</a>
      
        <a href="https://www.gergel.im/2014/01/20/time-in-cpp/#disqus_thread" class="article-comment-link">Commenti</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-11/" rel="tag">C++11</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chrono/" rel="tag">chrono</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/clock/" rel="tag">clock</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/duration/" rel="tag">duration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/time-point/" rel="tag">time_point</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/01/27/use-files/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">PiÃ¹ recente</strong>
      <div class="article-nav-title">
        
          Use files
        
      </div>
    </a>
  
  
    <a href="/2014/01/14/stl-algorithms-part-4/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Meno recente</strong>
      <div class="article-nav-title">STL Algorithms, part 4</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Gianluca Ciccarelli<br>
      Costruito con <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/index.html" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/now.html" class="mobile-nav-link">Now</a>
  
    <a href="/blog" class="mobile-nav-link">Blog</a>
  
    <a href="/fiction.html" class="mobile-nav-link">Fiction</a>
  
    <a href="/reads.html" class="mobile-nav-link">Reads</a>
  
    <a href="/software.html" class="mobile-nav-link">Software</a>
  
    <a href="/about-site.html" class="mobile-nav-link">Website</a>
  
    <a target="_blank" rel="noopener" href="//github.com/sturmer" class="mobile-nav-link">GitHub</a>
  
    <a href="/about-me.html" class="mobile-nav-link">Me</a>
  
</nav>
    
<script>
  var disqus_shortname = 'www-gergel-im-blog';
  
  var disqus_url = 'https://www.gergel.im/2014/01/20/time-in-cpp/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>