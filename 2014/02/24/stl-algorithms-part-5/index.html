<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45596498-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>STL Algorithms, part 5 | Gianluca Ciccarelli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Part 1 Part 2 Part 3 Part 4 Part 5  In the previous post in the series, we have analyzed more algorithms from the STL considered to be part of the non-modifying sequence operations. In this post, we">
<meta property="og:type" content="article">
<meta property="og:title" content="STL Algorithms, part 5">
<meta property="og:url" content="https://www.gergel.im/2014/02/24/stl-algorithms-part-5/index.html">
<meta property="og:site_name" content="Gianluca Ciccarelli">
<meta property="og:description" content="Part 1 Part 2 Part 3 Part 4 Part 5  In the previous post in the series, we have analyzed more algorithms from the STL considered to be part of the non-modifying sequence operations. In this post, we">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2014-02-23T22:00:00.000Z">
<meta property="article:modified_time" content="2020-08-15T09:14:02.634Z">
<meta property="article:author" content="Gianluca Ciccarelli">
<meta property="article:tag" content="algorithms">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@increatore">
  
    <link rel="alternate" href="/atom.xml" title="Gianluca Ciccarelli" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Gianluca Ciccarelli</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/index.html">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/now.html">Now</a>
        
          <a class="main-nav-link" href="/blog">Blog</a>
        
          <a class="main-nav-link" href="/fiction.html">Fiction</a>
        
          <a class="main-nav-link" href="/reads.html">Reads</a>
        
          <a class="main-nav-link" href="/software.html">Software</a>
        
          <a class="main-nav-link" href="/about-site.html">Website</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="//github.com/sturmer">GitHub</a>
        
          <a class="main-nav-link" href="/about-me.html">Me</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Ricerca"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://www.gergel.im"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-stl-algorithms-part-5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/02/24/stl-algorithms-part-5/" class="article-date">
  <!-- Use `hideDate: true` in a .md file to hide the date -->
  
  <time datetime="2014-02-23T22:00:00.000Z" itemprop="datePublished">2014-02-24</time>
  
</a>

    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      STL Algorithms, part 5
    </h1>
  

        
          [936 words]
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><a href="/2013/12/23/stl-algorithms-part-1">Part 1</a></li>
<li><a href="/2013/12/30/stl-algorithms-part-2">Part 2</a></li>
<li><a href="/2014/01/06/stl-algorithms-part-3">Part 3</a></li>
<li><a href="/2014/01/14/stl-algorithms-part-4">Part 4</a></li>
<li><a href="/2014/02/24/stl-algorithms-part-5">Part 5</a></li>
</ul>
<p>In the <a href="/blog/2014/01/14/stl-algorithms-part-4">previous post</a> in the series, we have analyzed more algorithms from the STL considered to be part of the non-modifying sequence operations. In this post, we are going to show some use case for algorithms which fall into the modifying sequence operations.</p>
<a id="more"></a>

<p>As brilliantly pointed out in <a target="_blank" rel="noopener" href="http://www.cppstdlib.com/">Josuttis</a>, however, note that an unordered container and an associative container can never be used as the destination of a modifying algorithm. The rationale is that elements in that kind of containers are constant after they’ve been inserted, and changing their content might compromise their order established by the sorting and hashing functions.</p>
<h2 id="copy-and-move"><a href="#copy-and-move" class="headerlink" title="copy and move"></a><code>copy</code> and <code>move</code></h2><p>We have seen an example in the <a href="/blog/2014/02/17/iterators-and-algorithms">last post</a>, where we have shown how to combine the <code>copy</code> algorithm with a <code>back_inserter</code> to provide, among other goodies, an elegant way of printing containers. The <code>copy</code> algorithm performs a sequence of assignments from elements of a container to elements of another one.  Its declaration, as defined in the standard ([alg.copy]), is:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">OutputIterator</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">OutputIterator</span> <span class="title">copy</span>(<span class="title">InputIterator</span> <span class="title">first</span>,</span></span><br><span class="line"><span class="class">                    <span class="title">InputIterator</span> <span class="title">last</span>,</span></span><br><span class="line"><span class="class">                    <span class="title">OutputIterator</span> <span class="title">result</span>);</span></span><br></pre></td></tr></table></figure>

<p>It’s really easy to understand with an example:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">v</span><span class="params">(&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">primes</span><span class="params">(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>&#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">copy(primes.<span class="built_in">begin</span>() + <span class="number">4</span>, primes.<span class="built_in">end</span>(), v.<span class="built_in">begin</span>() + <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Using Louis Delacroix&#x27;s cxx-prettyprint</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;v: &quot;</span> &lt;&lt; v &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>This copies the elements from the fifth to the last of the vector <code>primes</code> into the vector v, starting from the third position. Be very careful here: we are not inserting those elements between the elements 2 and the 3 of the vector <code>v</code>, we are overwriting positions 2 to 4 (starting from 0) with elements from <code>primes</code>.  The output is:</p>
<pre>
V: [1, 2, 7, 11, 13]
</pre>

<p>To print the vector, we have used Louis Delacroix’ <a target="_blank" rel="noopener" href="http://louisdx.github.io/cxx-prettyprint/">cxx-prettyprint</a>, a great tool to easily print STL containers. As you can see, the last three elements have been overwritten. If you had tried to do the same with a destination vector of size 4, this is the surprising end you’d have run into:</p>
<pre>
V: [1, 2, 7, 11]
</pre>

<p>This is what happens on my architecture (x86_64, with clang 3.2 and gcc 4.8.1 both showing the same result). The standard does not mention whether this is undefined behavior or not, but I find it risky anyway, so I’d rather check the relative sizes before attempting any copy. Again in Josuttis, however, we are said that <em>for <code>copy()</code>, <code>result</code> should not be part of the range [<code>first</code>, <code>last</code>)</em>.</p>
<h3 id="Using-move"><a href="#Using-move" class="headerlink" title="Using move"></a>Using <code>move</code></h3><p>You might have noticed that what we are doing is actually moving elements from one container to another. While the <code>copy</code> algorithm uses the copy assignment operator to perform the assignments, we might want to use the <code>move</code> algorithm in order to take advantage of a move assignment operator that the objects in the container might provide. Consider the following trivial code for a <code>struct</code> providing move contructors (I think I got the idea from <a target="_blank" rel="noopener" href="http://www.wrox.com/WileyCDA/WroxTitle/Professional-C-2nd-Edition.productCd-0470932449.html">Professional C++</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Moveable</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    Moveable(<span class="keyword">const</span> <span class="keyword">int</span> i) : i(i) &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ctor\n&quot;</span>; &#125;</span><br><span class="line">    Moveable(<span class="keyword">const</span> Moveable&amp; m) : i(m.i) &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;copy ctor\n&quot;</span>; &#125;</span><br><span class="line">    Moveable&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Moveable&amp; m) &#123; i = m.i; <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;copy assignment\n&quot;</span>; <span class="keyword">return</span> *<span class="keyword">this</span>; &#125;</span><br><span class="line">    Moveable(Moveable&amp;&amp; m) : i(m.i) &#123; m.i = <span class="number">0</span>; <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;move ctor\n&quot;</span>; &#125;</span><br><span class="line"></span><br><span class="line">    Moveable&amp; <span class="keyword">operator</span>=(Moveable&amp;&amp; m) &#123;</span><br><span class="line">        i = m.i;</span><br><span class="line">        m.i = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;move assignment\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>If we use this class in a <code>copy</code>, we obtain that, during the execution of the algorithm, the copy assignment operator is chosen to perform the assignment.  Using the <code>move</code> algorithm, instead, we use some client code like:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">vector</span>&lt;Moveable&gt; <span class="title">v1</span><span class="params">(&#123;Moveable(<span class="number">1</span>),Moveable(<span class="number">3</span>),Moveable(<span class="number">5</span>),Moveable(<span class="number">7</span>)&#125;)</span></span>;</span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;Moveable&gt; <span class="title">v2</span><span class="params">(&#123;Moveable(<span class="number">2</span>),Moveable(<span class="number">4</span>),Moveable(<span class="number">8</span>),Moveable(<span class="number">16</span>)&#125;)</span></span>;</span><br><span class="line"><span class="built_in">move</span>(v1.<span class="built_in">begin</span>(), v1.<span class="built_in">end</span>(), v2.<span class="built_in">begin</span>());</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;v1: &quot;</span> &lt;&lt; v1 &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;v2: &quot;</span> &lt;&lt; v2 &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>Our result is the following:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ctor</span><br><span class="line">ctor</span><br><span class="line">ctor</span><br><span class="line">ctor</span><br><span class="line">copy ctor</span><br><span class="line">copy ctor</span><br><span class="line">copy ctor</span><br><span class="line">copy ctor</span><br><span class="line">ctor</span><br><span class="line">ctor</span><br><span class="line">ctor</span><br><span class="line">ctor</span><br><span class="line">copy ctor</span><br><span class="line">copy ctor</span><br><span class="line">copy ctor</span><br><span class="line">copy ctor</span><br><span class="line"><span class="built_in">move</span> assignment</span><br><span class="line"><span class="built_in">move</span> assignment</span><br><span class="line"><span class="built_in">move</span> assignment</span><br><span class="line"><span class="built_in">move</span> assignment</span><br><span class="line">v1: [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">v2: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>]</span><br></pre></td></tr></table></figure>

<p>We have: 4 objects constructed in the initializer list, then copied in the vector; this happens for the 2 vectors; then the <code>move</code> algorithm is called, and 4 move assignments are performed. As you see, we have pilfered the values from the vector <code>v1</code>. Not that this was necessary; I think it only makes clear one criterion that should be noted: we use <code>copy</code> to copy elements between containers, but we use <code>move</code> when the elements in the source container are <em>disposable</em>, in the sense that we don’t access them after the move.</p>
<h2 id="Variations"><a href="#Variations" class="headerlink" title="Variations"></a>Variations</h2><p>The <code>copy</code> and <code>move</code> operations come with variants. The variants of copy are:</p>
<ul>
<li><code>copy_if</code></li>
<li><code>copy_backward</code></li>
<li><code>copy_n</code></li>
</ul>
<p>To copy when a condition is verified (determined by a function object), the algorithm with the <code>_if</code> suffix should be used.</p>
<p>If we want, instead, to copy the input range last to first element, we can use the backward version (that has a suffix <code>_backward</code>). One subtlety to which we have to pay attention is the matter of overlapping ranges.  The forward version can be used when the first element in the output sequence comes after the first element in the input sequence. The backward version is to be used whenever this does not hold true.</p>
<p>Finally, the suffix <code>_n</code> version can be used to directly specify the number of elements to be copied, rather than giving the end of the range. For example, we can say:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy_n(src.<span class="built_in">begin</span>(), <span class="number">10</span>, dest.<span class="built_in">begin</span>())</span><br></pre></td></tr></table></figure>

<p>instead of specifying the more cumbersome <code>src.begin()+10</code>.</p>
<p>The <code>move</code> algorithm, instead, only offers the variation to move backward, called, indeed, <code>move_backward</code>.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>We have started to have a brief look at the the sequence modifying algorithms.  The following is a resume table with the name of the algorithm and a one-line example usage:</p>
<table>
<thead>
<tr>
<th>Algorithm</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td><code>copy</code></td>
<td>copy(src.begin(), src.end(), dest.begin())</td>
</tr>
<tr>
<td><code>copy_backward</code></td>
<td>copy_backward(src.begin(), src.begin()+4, src.begin()+2)</td>
</tr>
<tr>
<td><code>move</code></td>
<td>move(src.begin(), src.end(), dest.begin())</td>
</tr>
<tr>
<td><code>move_backward</code></td>
<td>move(src.begin(), src.begin()+10, src.begin()+3)</td>
</tr>
<tr>
<td><code>copy_if</code></td>
<td>copy_if(src.begin(), src.end(), dest.begin(), [](int i){ return i &gt; 10; })</td>
</tr>
<tr>
<td><code>copy_n</code></td>
<td>copy_n(src.begin(), 10, dest.begin())</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.gergel.im/2014/02/24/stl-algorithms-part-5/" data-id="ckftzgnc40033xjfodtamb9uq" class="article-share-link">Condividi</a>
      
        <a href="https://www.gergel.im/2014/02/24/stl-algorithms-part-5/#disqus_thread" class="article-comment-link">Commenti</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithms/" rel="tag">algorithms</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/03/03/hash-tables/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Più recente</strong>
      <div class="article-nav-title">
        
          Hash tables
        
      </div>
    </a>
  
  
    <a href="/2014/02/17/iterators-and-algorithms/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Meno recente</strong>
      <div class="article-nav-title">Iterators and Algorithms: Insert Iterator Adapters</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Gianluca Ciccarelli<br>
      Costruito con <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/index.html" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/now.html" class="mobile-nav-link">Now</a>
  
    <a href="/blog" class="mobile-nav-link">Blog</a>
  
    <a href="/fiction.html" class="mobile-nav-link">Fiction</a>
  
    <a href="/reads.html" class="mobile-nav-link">Reads</a>
  
    <a href="/software.html" class="mobile-nav-link">Software</a>
  
    <a href="/about-site.html" class="mobile-nav-link">Website</a>
  
    <a target="_blank" rel="noopener" href="//github.com/sturmer" class="mobile-nav-link">GitHub</a>
  
    <a href="/about-me.html" class="mobile-nav-link">Me</a>
  
</nav>
    
<script>
  var disqus_shortname = 'www-gergel-im-blog';
  
  var disqus_url = 'https://www.gergel.im/2014/02/24/stl-algorithms-part-5/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>