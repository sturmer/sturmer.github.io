<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45596498-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>Accessing APIs | Gianluca Ciccarelli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I was curious about all the great sites I know of releasing their API. Twitter, Google, Facebook, Yelp, are only a few examples of websites providing a way to access their services in a programmatic w">
<meta property="og:type" content="article">
<meta property="og:title" content="Accessing APIs">
<meta property="og:url" content="https://www.gergel.im/2014/02/03/accessing-apis/index.html">
<meta property="og:site_name" content="Gianluca Ciccarelli">
<meta property="og:description" content="I was curious about all the great sites I know of releasing their API. Twitter, Google, Facebook, Yelp, are only a few examples of websites providing a way to access their services in a programmatic w">
<meta property="og:locale">
<meta property="article:published_time" content="2014-02-02T22:00:00.000Z">
<meta property="article:modified_time" content="2020-08-15T09:14:02.628Z">
<meta property="article:author" content="Gianluca Ciccarelli">
<meta property="article:tag" content="C++11">
<meta property="article:tag" content="API">
<meta property="article:tag" content="POCO">
<meta property="article:tag" content="HTTP">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@increatore">
  
    <link rel="alternate" href="/atom.xml" title="Gianluca Ciccarelli" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Gianluca Ciccarelli</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/index.html">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/now.html">Now</a>
        
          <a class="main-nav-link" href="/blog">Blog</a>
        
          <a class="main-nav-link" href="/fiction.html">Fiction</a>
        
          <a class="main-nav-link" href="/reads.html">Reads</a>
        
          <a class="main-nav-link" href="/software.html">Software</a>
        
          <a class="main-nav-link" href="/about-site.html">Website</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="//github.com/sturmer">GitHub</a>
        
          <a class="main-nav-link" href="/about-me.html">Me</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://www.gergel.im"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-accessing-apis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/02/03/accessing-apis/" class="article-date">
  <!-- Use `hideDate: true` in a .md file to hide the date -->
  
  <time datetime="2014-02-02T22:00:00.000Z" itemprop="datePublished">2014-02-03</time>
  
</a>

    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Accessing APIs
    </h1>
  

        
          [614 words]
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I was curious about all the great sites I know of releasing their API. Twitter, Google, Facebook, Yelp, are only a few examples of websites providing a way to access their services in a programmatic way. In this post, I have investigated a simple but very interesting API, offered by <a target="_blank" rel="noopener" href="http://rottentomatoes.com/" title="Rotten Tomatoes">Rotten Tomatoes</a>, a website about movies.</p>
<a id="more"></a>

<h3 id="Before-Coding"><a href="#Before-Coding" class="headerlink" title="Before Coding"></a>Before Coding</h3><p>Apparently, most if not all the websites offering API access to their services, require you to register as a developer, in order to provide you with an API key. The registration form for Rotten Tomatoes can be found, for example, at the <a target="_blank" rel="noopener" href="http://bit.ly/1eoIiOB" title="Rotten Tomatoes API">Developersâ€™ page</a>.  Once you register an account and request an API key, you can use it to access the API. This kind of accountability is important, because the damage you can do by making tons of requests to a website can easily become an example of DoS attacks. The number of requests is limited, as well (5 per seconds and 10,000 per day).</p>
<h3 id="The-POCO-Libraries"><a href="#The-POCO-Libraries" class="headerlink" title="The POCO Libraries"></a>The POCO Libraries</h3><p>In order to more easily manipulate HTTP requests and response, I have tried out the <a target="_blank" rel="noopener" href="http://pocoproject.org/" title="POCO libraries">POCO libraries</a>, a nice set of wrappers around extremely useful features, that range from Base64 encoding/decoding to socket programming, to XML manipulation, to DBMS interactions. The simple code I provide here uses the <em>Net</em> classes, that offer useful abstractions like <code>HTTPRequest</code>, <code>HTTPResponse</code>, <code>HTMLForm</code>, and the likes.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="function">HTTPRequest <span class="title">movierequest</span><span class="params">(HTTPRequest::HTTP_GET,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="string">&quot;/api/public/v1.0/movies.json&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">            HTTPMessage::HTTP_1_1)</span></span>;</span><br><span class="line">        HTMLForm form;</span><br><span class="line">        form.add(<span class="string">&quot;apikey&quot;</span>, <span class="string">&quot;&#123;your_api_key&#125;&quot;</span>); <span class="comment">// use your API key here!!</span></span><br><span class="line">        form.add(<span class="string">&quot;page&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        form.add(<span class="string">&quot;page_limit&quot;</span>, <span class="string">&quot;10&quot;</span>);</span><br><span class="line">        form.add(<span class="string">&quot;q&quot;</span>, <span class="string">&quot;Toy+Story&quot;</span>);</span><br><span class="line">        form.prepareSubmit(movierequest);</span><br><span class="line"></span><br><span class="line">        <span class="function">HTTPClientSession <span class="title">s</span><span class="params">(<span class="string">&quot;api.rottentomatoes.com&quot;</span>)</span></span>;</span><br><span class="line">        s.sendRequest(movierequest);</span><br><span class="line">        HTTPResponse resp;</span><br><span class="line">        istream&amp; response_stream = s.receiveResponse(resp);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; resp.getStatus() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; resp.getReason() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="function">ofstream <span class="title">result</span><span class="params">(<span class="string">&quot;toystory.txt&quot;</span>)</span></span>;</span><br><span class="line">        Poco::StreamCopier::copyStream(response_stream, result);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Poco::Exception&amp; ex) &#123;</span><br><span class="line">        <span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;Exception: &quot;</span> &lt;&lt; ex.className() &lt;&lt; <span class="string">&quot; -- &quot;</span> &lt;&lt;</span><br><span class="line">            ex.displayText() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Letâ€™s examine this code from closer. The complete source code is provided as a <a target="_blank" rel="noopener" href="https://gist.github.com/sturmer/8755127">Github gist</a>.</p>
<h3 id="Making-a-GET-request"><a href="#Making-a-GET-request" class="headerlink" title="Making a GET request"></a>Making a GET request</h3><p>Letâ€™s dissect the code presented above.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HTTPRequest <span class="title">movierequest</span><span class="params">(HTTPRequest::HTTP_GET,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="string">&quot;/api/public/v1.0/movies.json&quot;</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    HTTPMessage::HTTP_1_1)</span></span>;</span><br></pre></td></tr></table></figure>

<p>We make an <code>HTTP GET</code> request in order to retrieve data from the web service by passing the proper parameters in a query string. The POCO libraries give us access to an <code>HTTPRequest</code>, that is constructed by passing it the HTTP method, the last part of the query url, and the version of HTTP, for which two enum values are provided, <code>HTTP_1_0</code> and <code>HTTP_1_1</code>, for versions 1.0 and 1.1.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTMLForm form;</span><br><span class="line">form.add(<span class="string">&quot;apikey&quot;</span>, <span class="string">&quot;&#123;your_api_key&#125;&quot;</span>);</span><br><span class="line">form.add(<span class="string">&quot;page&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">form.add(<span class="string">&quot;page_limit&quot;</span>, <span class="string">&quot;10&quot;</span>);</span><br><span class="line">form.add(<span class="string">&quot;q&quot;</span>, <span class="string">&quot;Toy+Story&quot;</span>);</span><br><span class="line">form.prepareSubmit(movierequest);</span><br></pre></td></tr></table></figure>

<p>The <code>HTMLForm</code> is useful for passing parameters to the request. This<br>is just done by providing key-value pairs for each relevant parameter. As you<br>see, when we are done, we call a <code>prepareSubmit()</code> method to pass<br>the values to the request object.</p>
<h3 id="Calling-the-Server-Reading-the-Response"><a href="#Calling-the-Server-Reading-the-Response" class="headerlink" title="Calling the Server, Reading the Response"></a>Calling the Server, Reading the Response</h3><p>In order to call the API service, we need to instantiate a <code>HTTPClientSession</code> object, that is initialized with the name of the host providing the service.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">HTTPClientSession <span class="title">s</span><span class="params">(<span class="string">&quot;api.rottentomatoes.com&quot;</span>)</span></span>;</span><br><span class="line">s.sendRequest(movierequest);</span><br></pre></td></tr></table></figure>

<p>The request is sent by calling the method <code>sendRequest()</code>. It is interesting that, in case we wanted to pass a body (for example in a POST request), we could have simply called the get <code>operator&lt;&lt;()</code>, like <code>s.sendRequest() &lt;&lt; req_body;</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTPResponse resp;</span><br><span class="line">istream&amp; response_stream = s.receiveResponse(resp);</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; resp.getStatus() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; resp.getReason() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="function">ofstream <span class="title">result</span><span class="params">(<span class="string">&quot;toystory.txt&quot;</span>)</span></span>;</span><br><span class="line">Poco::StreamCopier::copyStream(response_stream, result);</span><br></pre></td></tr></table></figure>

<p>Finally, we want to get the response. We instantiate an object of type <code>HTTPResponse</code>, not surprisingly, and then call the <code>receiveResponse()</code> on the client-initiated session object. The <code>StreamCopier</code> is useful to print the result into an output stream, that we can then parse at will.</p>
<p>The resulting file looks something like the following:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;total&quot;</span> : <span class="number">3</span>,</span><br><span class="line">    <span class="string">&quot;movies&quot;</span> : [</span><br><span class="line">        &#123;<span class="string">&quot;id&quot;</span> : <span class="string">&quot;770672122&quot;</span>,</span><br><span class="line">        <span class="string">&quot;title&quot;</span> : <span class="string">&quot;Toy Story 3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;year&quot;</span> : <span class="number">2010</span>,</span><br><span class="line">        <span class="string">&quot;mpaa_rating&quot;</span> : <span class="string">&quot;G&quot;</span>,</span><br><span class="line">        <span class="string">&quot;runtime&quot;</span> : <span class="number">103</span>,</span><br><span class="line">        <span class="string">&quot;critics_consensus&quot;</span> : <span class="string">&quot;Deftly blending comedy, adventure, and honest emotion, Toy Story 3 is a rare second sequel that really works.&quot;</span>,</span><br><span class="line">        <span class="string">&quot;release_dates&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;theater&quot;</span> : <span class="string">&quot;2010-06-18&quot;</span>,</span><br><span class="line">            <span class="string">&quot;dvd&quot;</span> : <span class="string">&quot;2010-11-02&quot;</span>&#125;,</span><br><span class="line">        <span class="string">&quot;ratings&quot;</span> : ...</span><br></pre></td></tr></table></figure>

<h3 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h3><p>The POCO libraries have been an interesting surprise. They are very well documented, and simplify several tasks which prove fundamental when dealing with the network.</p>
<p>I have tried also to access the Twitter API, but that deserves a post apart, because I had some problems with the authentication that is more sophisticated than Rotten Tomatoesâ€™, also because of the huge amount of data that you can query. A great tool for debugging your programs can be found at the <a target="_blank" rel="noopener" href="http://developer.rottentomatoes.com/io-docs">IO Docs page</a>, that generates the request string according to the parameter provided in a form, executes the request, and finally displays the result; a similar tool is present also for Twitter.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.gergel.im/2014/02/03/accessing-apis/" data-id="ckjiazi2o000345vn1900hghu" class="article-share-link">Share</a>
      
        <a href="https://www.gergel.im/2014/02/03/accessing-apis/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/API/" rel="tag">API</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-11/" rel="tag">C++11</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP/" rel="tag">HTTP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/POCO/" rel="tag">POCO</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/02/17/iterators-and-algorithms/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Iterators and Algorithms: Insert Iterator Adapters
        
      </div>
    </a>
  
  
    <a href="/2014/01/27/use-files/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Use files</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Gianluca Ciccarelli<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/index.html" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/now.html" class="mobile-nav-link">Now</a>
  
    <a href="/blog" class="mobile-nav-link">Blog</a>
  
    <a href="/fiction.html" class="mobile-nav-link">Fiction</a>
  
    <a href="/reads.html" class="mobile-nav-link">Reads</a>
  
    <a href="/software.html" class="mobile-nav-link">Software</a>
  
    <a href="/about-site.html" class="mobile-nav-link">Website</a>
  
    <a target="_blank" rel="noopener" href="//github.com/sturmer" class="mobile-nav-link">GitHub</a>
  
    <a href="/about-me.html" class="mobile-nav-link">Me</a>
  
</nav>
    
<script>
  var disqus_shortname = 'www-gergel-im-blog';
  
  var disqus_url = 'https://www.gergel.im/2014/02/03/accessing-apis/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>