<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45596498-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>Lambdas in C++11, part 2 | Gianluca Ciccarelli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Part 1 In the previous post, I have shown the syntax of lambda expressions in C++11, also known as closures, that are basically unnamed function objects that can be passed around for convenience, enha">
<meta property="og:type" content="article">
<meta property="og:title" content="Lambdas in C++11, part 2">
<meta property="og:url" content="https://www.gergel.im/2013/12/16/lambdas-in-cpp-11-part-2/index.html">
<meta property="og:site_name" content="Gianluca Ciccarelli">
<meta property="og:description" content="Part 1 In the previous post, I have shown the syntax of lambda expressions in C++11, also known as closures, that are basically unnamed function objects that can be passed around for convenience, enha">
<meta property="og:locale">
<meta property="article:published_time" content="2013-12-15T22:00:00.000Z">
<meta property="article:modified_time" content="2020-08-15T09:14:02.646Z">
<meta property="article:author" content="Gianluca Ciccarelli">
<meta property="article:tag" content="C++11">
<meta property="article:tag" content="closures">
<meta property="article:tag" content="lambdas">
<meta property="article:tag" content="functor">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@increatore">
  
    <link rel="alternate" href="/atom.xml" title="Gianluca Ciccarelli" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Gianluca Ciccarelli</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/index.html">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/now.html">Now</a>
        
          <a class="main-nav-link" href="/blog">Blog</a>
        
          <a class="main-nav-link" href="/fiction.html">Fiction</a>
        
          <a class="main-nav-link" href="/reads.html">Reads</a>
        
          <a class="main-nav-link" href="/software.html">Software</a>
        
          <a class="main-nav-link" href="/about-site.html">Website</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="//github.com/sturmer">GitHub</a>
        
          <a class="main-nav-link" href="/about-me.html">Me</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://www.gergel.im"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-lambdas-in-cpp-11-part-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/12/16/lambdas-in-cpp-11-part-2/" class="article-date">
  <!-- Use `hideDate: true` in a .md file to hide the date -->
  
  <time datetime="2013-12-15T22:00:00.000Z" itemprop="datePublished">2013-12-16</time>
  
</a>

    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Lambdas in C++11, part 2
    </h1>
  

        
          [780 words]
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="/blog/2013/12/09/lambdas-in-cpp-11/">Part 1</a></p>
<p>In the <a href="/blog/2013/12/09/lambdas-in-cpp-11/">previous post</a>, I have shown the syntax of lambda expressions in C++11, also known as closures, that are basically unnamed function objects that can be passed around for convenience, enhancing correctness through readability.</p>
<a id="more"></a>

<p>In this installment, as promised, we will have a look at one of the basic advantages of using lambdas, by first introducing a small Functor (a function class, or, a class with an overloading of <code>operator()</code>), and then seeing it being substituted with a shiny closure.</p>
<h3 id="Small-functor"><a href="#Small-functor" class="headerlink" title="Small functor"></a>Small functor</h3><p>In the previous version of the language, several of the STL containers allow the user to provide a class to a container constructor, that encapsulates the notion of order among elements of the container. This notion is important for usage with sorting algorithms (like <code>std::sort</code>), but might become fundamental when using certain containers, like sets or priority queues.</p>
<p>Consider, for example, the following program:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;task.hpp&quot;</span></span></span><br><span class="line"><span class="comment">// includes, using declarations</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="built_in">Task</span> <span class="title">task1</span><span class="params">(<span class="number">1</span>, <span class="string">&quot;Laundry&quot;</span>)</span></span>;</span><br><span class="line">   <span class="function"><span class="built_in">Task</span> <span class="title">task2</span><span class="params">(<span class="number">3</span>, <span class="string">&quot;Hackery&quot;</span>)</span></span>;</span><br><span class="line">   <span class="function"><span class="built_in">Task</span> <span class="title">task3</span><span class="params">(<span class="number">2</span>, <span class="string">&quot;Grocery&quot;</span>)</span></span>;</span><br><span class="line">   <span class="built_in">priority_queue</span>&lt;<span class="built_in">Task</span>, <span class="built_in">vector</span>&lt;<span class="built_in">Task</span>&gt;, less&lt;<span class="built_in">Task</span>&gt;&gt; q;</span><br><span class="line">   q.push(task1);</span><br><span class="line">   q.push(task2);</span><br><span class="line">   q.push(task3);</span><br><span class="line">   <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">       <span class="built_in">cout</span> &lt;&lt; q.top() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">       q.pop();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This program declares 3 tasks, each one identified by a priority and a name. The priority queue is defined over the class <code>Task</code>, is implemented with a <code>std::vector</code>, and depends on a standard functor, <code>less</code>. (Having to specify the use of a vector comes unfortunately from the way the <code>priority_queue</code> is designed.)</p>
<p>The <code>std::less</code> class is a convenience class provided by the standard library to be used with containers and algorithms. We can use it to customize the sorting order of the tasks in our priority queue. While the default types have their specialization already, that works mostly out-of-the-box, we need to provide a criterion to our queue for the right sorting. Say, for example, that the sorting is per ascending priority (i.e., task with priority 9 has higher priority than task with priority 0): we would express it like:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="built_in">std</span> &#123;</span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">less</span>&lt;Task&gt; &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="built_in">Task</span>&amp; t1, <span class="keyword">const</span> <span class="built_in">Task</span>&amp; t2)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t1.priority_ &lt; t2.priority_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Pretty simple: we specialize the template struct for the class <code>Task</code>, and add it to the <code>std</code> namespace. For completeness, let&#39;s have a look at the <code>Task</code> class declaration:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Task</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> priority_;</span><br><span class="line">    <span class="built_in">string</span> description_;</span><br><span class="line">    <span class="built_in">Task</span>(<span class="keyword">int</span> p, <span class="built_in">string</span> d) : priority_(p), description_(d) &#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>If we compile the program, the output of the resulting executable is the following:</p>
<pre>
3: Hackery
2: Grocery
1: Laundry
</pre>

<h3 id="Beauty-of-the-lambda"><a href="#Beauty-of-the-lambda" class="headerlink" title="Beauty of the lambda"></a>Beauty of the lambda</h3><p>The point is, we are trying to do something very simple: we only want to pass a function to the <code>priority_queue</code> constructor, to let it do its job of keeping the tasks sorted. In previous versions of the standard, we had to specialize a template struct, and plug it in the <code>std</code> namespace. While certainly not a major feat, try to compare it with the following, closure-based implementation:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// #includes, using declarations</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Task</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> priority_;</span><br><span class="line">    <span class="built_in">string</span> description_;</span><br><span class="line">    <span class="built_in">Task</span>(<span class="keyword">int</span> p, <span class="built_in">string</span> d) : priority_(p), description_(d) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ostream&amp; <span class="keyword">operator</span>&lt;&lt;(ostream&amp; os, <span class="keyword">const</span> <span class="built_in">Task</span>&amp; t) &#123;</span><br><span class="line">    os &lt;&lt; t.priority_ &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; t.description_;</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="built_in">Task</span> <span class="title">task1</span><span class="params">(<span class="number">1</span>, <span class="string">&quot;Laundry&quot;</span>)</span></span>;</span><br><span class="line">   <span class="function"><span class="built_in">Task</span> <span class="title">task2</span><span class="params">(<span class="number">3</span>, <span class="string">&quot;Hackery&quot;</span>)</span></span>;</span><br><span class="line">   <span class="function"><span class="built_in">Task</span> <span class="title">task3</span><span class="params">(<span class="number">2</span>, <span class="string">&quot;Grocery&quot;</span>)</span></span>;</span><br><span class="line">   <span class="keyword">auto</span> compare_tasks = [](<span class="keyword">const</span> <span class="built_in">Task</span>&amp; t1, <span class="keyword">const</span> <span class="built_in">Task</span>&amp; t2) &#123; <span class="keyword">return</span> t1.priority_ &lt; t2.priority_; &#125;;</span><br><span class="line">   priority_queue&lt;Task, vector&lt;Task&gt;, decltype(compare_tasks)&gt; q(compare_tasks);</span><br><span class="line">   q.push(task1);</span><br><span class="line">   q.push(task2);</span><br><span class="line">   q.push(task3);</span><br><span class="line">   <span class="keyword">while</span> (!q.empty()) &#123;</span><br><span class="line">       <span class="built_in">cout</span> &lt;&lt; q.top() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">       q.pop();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We don’t even need a separate header, because we have no template. The only trick here is to wrap the parameter <code>compare_tasks</code> in a <code>decltype</code>. In a nutshell, <code>decltype</code> returns the type of the expression used as its argument (but see [<code>dcl.type.simple</code>] in the standard for the precise definition). This is necessary, because a template parameter needs be a class, or the result of an expression that can be computed at compile time. The lambda is not a class, but an object of anonymous type: see, for example, again [<code>expr.prim.lambda</code>]:</p>
<blockquote>
<p>The type of the lambda-expression (which is also the type of the closure object) is a unique, unnamed non- union class type […]</p>
</blockquote>
<p>This means that we need a way to express the type of the lambda. One way to do it is that first we define the lambda to be of type auto, and then we express the type itself as the result of a <code>decltype</code> evaluation, which is equivalent to saying: _Whatever is the type of this closure, feed it to the priority_queue constructor_. This solves the problem, and makes the program compilable and the output identical to the version with functors.</p>
<p>See also this <a target="_blank" rel="noopener" href="http://stackoverflow.com/a/3867323">stackoverflow answer</a> for a thorough discussion about the advantages and disadvantages of this solution: I found it really useful to understand the need for <code>decltype</code>.</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>Lambdas provide a convenient, readable, and concise way to express the notion of a function object. They are useful in every context where it is necessary to pass a function around, like to implement callback mechanisms, and notably as function objects that interact nicely with STL algorithms and containers. As a side-note, let me confess that I prefer to call them <em>closures</em> only because I am not able to spell the word <em>lambda</em> correctly on the fly (when out of Vim, of course :)).</p>
<p>This concludes our mini-tour of the closures in C++11. As usual, the complete version of the code we have discussed in this post is available as a <a target="_blank" rel="noopener" href="https://gist.github.com/sturmer/7915819">Gist</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.gergel.im/2013/12/16/lambdas-in-cpp-11-part-2/" data-id="ckdvgdcx6001j2ofof2hddh6n" class="article-share-link">Share</a>
      
        <a href="https://www.gergel.im/2013/12/16/lambdas-in-cpp-11-part-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-11/" rel="tag">C++11</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/closures/" rel="tag">closures</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/functor/" rel="tag">functor</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lambdas/" rel="tag">lambdas</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2013/12/23/stl-algorithms-part-1/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          STL Algorithms, part 1
        
      </div>
    </a>
  
  
    <a href="/2013/12/09/lambdas-in-cpp-11/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Lambdas in C++11</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Gianluca Ciccarelli<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/index.html" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/now.html" class="mobile-nav-link">Now</a>
  
    <a href="/blog" class="mobile-nav-link">Blog</a>
  
    <a href="/fiction.html" class="mobile-nav-link">Fiction</a>
  
    <a href="/reads.html" class="mobile-nav-link">Reads</a>
  
    <a href="/software.html" class="mobile-nav-link">Software</a>
  
    <a href="/about-site.html" class="mobile-nav-link">Website</a>
  
    <a target="_blank" rel="noopener" href="//github.com/sturmer" class="mobile-nav-link">GitHub</a>
  
    <a href="/about-me.html" class="mobile-nav-link">Me</a>
  
</nav>
    
<script>
  var disqus_shortname = 'www-gergel-im-blog';
  
  var disqus_url = 'https://www.gergel.im/2013/12/16/lambdas-in-cpp-11-part-2/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>