<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-45596498-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>STL Algorithms, part 2 | Gianluca Ciccarelli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Part 1 Part 2 Part 3 Part 4 Part 5  Previously on this blogIn the previous installment, we have introduced three algorithms, all_of, any_of, and none_of, very useful to determine whether a range of e">
<meta property="og:type" content="article">
<meta property="og:title" content="STL Algorithms, part 2">
<meta property="og:url" content="https://www.gergel.im/2013/12/30/stl-algorithms-part-2/index.html">
<meta property="og:site_name" content="Gianluca Ciccarelli">
<meta property="og:description" content="Part 1 Part 2 Part 3 Part 4 Part 5  Previously on this blogIn the previous installment, we have introduced three algorithms, all_of, any_of, and none_of, very useful to determine whether a range of e">
<meta property="og:locale">
<meta property="article:published_time" content="2013-12-29T22:00:00.000Z">
<meta property="article:modified_time" content="2021-01-06T15:37:51.869Z">
<meta property="article:author" content="Gianluca Ciccarelli">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="STL">
<meta property="article:tag" content="algorithms">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@increatore">
  
    <link rel="alternate" href="/atom.xml" title="Gianluca Ciccarelli" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.0.2"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Gianluca Ciccarelli</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/index.html">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/now.html">Now</a>
        
          <a class="main-nav-link" href="/blog">Blog</a>
        
          <a class="main-nav-link" href="/reads.html">Reads</a>
        
          <a class="main-nav-link" href="/software.html">Software</a>
        
          <a class="main-nav-link" href="/about-site.html">Website</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="//github.com/sturmer">GitHub</a>
        
          <a class="main-nav-link" href="/about-me.html">Me</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://www.gergel.im"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-stl-algorithms-part-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/12/30/stl-algorithms-part-2/" class="article-date">
  <!-- Use `hideDate: true` in a .md file to hide the date -->
  
  <time datetime="2013-12-29T22:00:00.000Z" itemprop="datePublished">2013-12-30</time>
  
</a>

    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      STL Algorithms, part 2
    </h1>
  

        
          [845 words]
        
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><a href="/2013/12/23/stl-algorithms-part-1">Part 1</a></li>
<li><a href="/2013/12/30/stl-algorithms-part-2">Part 2</a></li>
<li><a href="/2014/01/06/stl-algorithms-part-3">Part 3</a></li>
<li><a href="/2014/01/14/stl-algorithms-part-4">Part 4</a></li>
<li><a href="/2014/02/24/stl-algorithms-part-5">Part 5</a></li>
</ul>
<h3 id="Previously-on-this-blog"><a href="#Previously-on-this-blog" class="headerlink" title="Previously on this blog"></a>Previously on this blog</h3><p>In the previous installment, we have introduced three algorithms, <code>all_of</code>, <code>any_of</code>, and <code>none_of</code>, very useful to determine whether a range of elements satisfy some predicate, expressed as a lambda.</p>
<p>In this second episode, we will explore more algorithms offered by the STL. My objective, in the long run, is to cover all of them with examples, and maybe grasp the ideas that might come to my mind during the process. As usual, if you have any doubt or just spot a plain error, I’d greatly appreciate if you let me know.</p>
<a id="more"></a>

<h3 id="for-each-Act-I"><a href="#for-each-Act-I" class="headerlink" title="for_each (Act I)"></a>for_each (Act I)</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">InputIterator</span>, <span class="title">class</span> <span class="title">Function</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">Function</span> <span class="title">for_each</span>(<span class="title">InputIterator</span> <span class="title">first</span>, <span class="title">InputIterator</span> <span class="title">last</span>, <span class="title">Function</span> <span class="title">f</span>);</span></span><br></pre></td></tr></table></figure>

<p>The algorithms that we have seen so far fall into the category of <em>non-modifying sequence operations</em>, because they can be applied without having to worry about changing the underlying range (or to invalidate the container).  The next few ones fall in the same category.</p>
<p>A very interesting one is the <code>for_each</code> algorithm. It can be used to apply some operation to a range of elements. Things become tricky in this case, because the algorithm requires the function, that we want to apply to the elements in the range, to be <em>MoveConstructible</em>.  I will cover rvalue references and move semantics in one of the next posts (or you can have a look at this excellent <a target="_blank" rel="noopener" href="http://holdstare.github.io/technical/2013/11/23/moves-demystified.html">post</a>, the best I have read so far about the subject), but for now it is enough to say that this means what follows.</p>
<h4 id="Intermezzo-being-MoveConstructible"><a href="#Intermezzo-being-MoveConstructible" class="headerlink" title="Intermezzo: being MoveConstructible"></a>Intermezzo: being MoveConstructible</h4><p>Being <em>MoveConstructible</em>, for an object (in this case a function object or a lambda), means that it must obey a post-condition. In this case, if we have either of the following expressions:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">T t = rv</span><br><span class="line">T(rv)</span><br></pre></td></tr></table></figure>

<p>then the post-condition (in the first case) is that <code>t</code> has the same value that <code>rv</code> used to have, before <code>t</code>‘s construction is terminated (that is to say, before this statement), but after <code>t</code> is constructed (and this statement has been executed), no guarantee is given about the state of <code>rv</code> (in particular, its state might be different from the state it had before the assignment). The same is true for the second type of expression.</p>
<p>This requirement is stronger than being required to be <em>CopyConstructible</em>, where the state of <code>rv</code> after the assignment has to stay unchanged.  For now, we can think of move semantics as a way of reducing the number of object creations. To do this, the language offers the chance to change the state of an object being moved from.</p>
<h3 id="for-each-Act-II"><a href="#for-each-Act-II" class="headerlink" title="for_each (Act II)"></a><code>for_each</code> (Act II)</h3><p>What does this mean with respect to our usage of <code>for_each</code>? This has to do with the return type of the algorithm: it is <code>std::move(f)</code>. Since <code>f</code> is required to be <em>MoveConstructible</em>, this guarantees that, if <code>f</code> is an object with a state, then the returned value has a valid state, even if optimizations are applied when returning it.</p>
<p>It can be exemplified like follows:</p>
<pre>
for each element in the range
    dereference the element
    apply the function f
return a (possibly destructive) copy of f
</pre>

<p>When returning, the result of the copy is perfectly valid, but the object it is copied from might get altered by the copy operation. The fact that this copy is actually a <em>move</em> is not important to understand the effects.  The net result is: we can neglect this, and leave the responsibility to the implementer of the STL.  </p>
<p>An example will make everything clear:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    for_each(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(),</span><br><span class="line">            [](<span class="keyword">int</span>&amp; i) &#123; i *= <span class="number">2</span>; &#125;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; vv: v)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; vv &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This will print the numbers 2, 4, 6. Note that the standard specifies that, if <code>f</code> returns a result (which is not the case for our example), that result is ignored. As you can see, even though <code>for_each</code> is supposed to belong to the non-modifying sequence operations, it can alter the values of the elements in the container. This has been object of a discussion; one conclusion is that the <code>for_each</code> itself does not modify the container, while the function <code>f</code> could; another, is that modifying the elements is not equivalent to modifying the sequence’s structure (i.e., the <code>for_each</code> does not invalidate the underlying pointers). If you are interested in the fine points of the discussion, you can have a look <a target="_blank" rel="noopener" href="http://www.open-std.org/jtc1/sc22/wg21/docs/lwg-defects.html#475">here</a> and <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/662845/why-is-stdfor-each-a-non-modifying-sequence-operation">here</a>.</p>
<h3 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h3><p>We have seen another fine algorithm offered by the standard template library.  Even though of simple application, this one has been subject to some debate about its classification as non-modifying sequence operation; it has also given me the chance to provide a first (very incomplete!) explanation of what is the move semantics in the C++11 standard.</p>
<p>In the next installment of this series, I am going to talk about algorithms for finding elements in a container (searching algorithms).</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://www.gergel.im/2013/12/30/stl-algorithms-part-2/" data-id="ckjquddgw0031ulptewyz0n8x" class="article-share-link">Share</a>
      
        <a href="https://www.gergel.im/2013/12/30/stl-algorithms-part-2/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/STL/" rel="tag">STL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithms/" rel="tag">algorithms</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/01/06/stl-algorithms-part-3/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          STL Algorithms, part 3
        
      </div>
    </a>
  
  
    <a href="/2013/12/23/stl-algorithms-part-1/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">STL Algorithms, part 1</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 Gianluca Ciccarelli<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/index.html" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/now.html" class="mobile-nav-link">Now</a>
  
    <a href="/blog" class="mobile-nav-link">Blog</a>
  
    <a href="/reads.html" class="mobile-nav-link">Reads</a>
  
    <a href="/software.html" class="mobile-nav-link">Software</a>
  
    <a href="/about-site.html" class="mobile-nav-link">Website</a>
  
    <a target="_blank" rel="noopener" href="//github.com/sturmer" class="mobile-nav-link">GitHub</a>
  
    <a href="/about-me.html" class="mobile-nav-link">Me</a>
  
</nav>
    
<script>
  var disqus_shortname = 'www-gergel-im-blog';
  
  var disqus_url = 'https://www.gergel.im/2013/12/30/stl-algorithms-part-2/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>